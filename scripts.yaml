night_mode:
  alias: Good night
  sequence:
    - service: script.turn_on
      data_template:
        entity_id: >
          {% if states.sensor.projector_status.state == 'on' %} script.projector_off
          {% else %} script.nothing
          {% endif %}
    - service: light.turn_off
      data_template:
        entity_id: >
          {%- for state in states.light if state.entity_id != 'light.entrance' -%}
          {{- "," if not loop.first-}}{{ state.entity_id }}{{-endif-}}
          {%- endfor -%}
    - service: light.turn_on
      entity_id: light.kitchen
    - service: switch.turn_off
      data_template:
        entity_id: >
          {%- for state in states.switch if
          state.entity_id != 'switch.projector' and
          state.entity_id != 'switch.projector_esc' and
          state.entity_id != 'switch.rikis_food' and
          state.entity_id != 'switch.trantor_power'-%}
          {{- "," if not loop.first-}}{{ state.entity_id }}{{-endif-}}
          {%- endfor -%}
    - service: light.turn_on
      entity_id: light.kitchen
    # - service: media_player.play_media
      # data:
        # entity_id: media_player.living_room_speaker
        # media_content_id: !secret good_night_wav
        # media_content_type: music

projector_off:
  alias: Turn Projector OFF
  sequence:
    - service: switch.turn_off
      entity_id: switch.projector
    - delay: '00:00:01'
    - service: switch.turn_off
      entity_id: switch.projector

make_coffe:
  alias: Intelia coffee machine
  sequence:
    service: script.turn_on
    data_template:
      entity_id: >
        {% if states.switch.coffee_machine.state == 'on' %} script.coffee_machine_on
        {% elif states.switch.coffee_machine.state == 'off'%} script.coffee_machine_off
        {% endif %}

coffee_machine_off:
  alias: Power on and make coffee
  sequence:
    - service: switch.turn_on
      entity_id: switch.coffee_machine
    - wait_template: "{{ states.switch.coffee_machine.state == 'on' }}"
      timeout: '00:01:10'
      continue_on_timeout: false
    - service: notify.hass
      data:
        message:  "intelia: is on and waiting"
    - wait_template: "{{ states.binary_sensor.motion_sensor_kitchen.state == 'on' }}"
      timeout: '00:02:00'
      continue_on_timeout: false
    - service: notify.hass
      data:
        message:  "intelia: human detected, starting countdown 10s..."
    - delay: '00:00:10'
    # - service: switch.turn_on
      # entity_id: switch.coffee
    - service: light.turn_on
      entity_id: light.bob
    
coffee_machine_on:
  alias: Make coffee
  sequence:
    - wait_template: "{{ states.binary_sensor.motion_sensor_kitchen.state == 'on' }}"
      continue_on_timeout: false
    - service: switch.turn_on
      entity_id: switch.coffee


movie_time:
  alias: movie time
  sequence:
    - service: light.turn_on
      entity_id: light.spot
    - service: homeassistant.turn_off
      entity_id: group.guster
    - service: switch.turn_on
      entity_id: switch.projector

storj_information:
  alias: storj information
  sequence:
    - service: shell_command.storj
    - service: shell_command.tts_storj
      data_template:
        arg: "{{states.sensor.storj.state}}"
    - delay: '00:00:01'
    - service: media_player.play_media
      data:
        entity_id: media_player.living_room_speaker
        media_content_id: !secret storj_wav
        media_content_type: music

restart:
  alias: abracadabra
  sequence:
    - service: homeassistant.restart

house_mode_away:
  sequence:
    - service: light.turn_off
      data_template:
        entity_id: >
          {%- for state in states.light if state.entity_id != 'light.entrance' -%}
          {{- "," if not loop.first-}}{{ state.entity_id }}{{-endif-}}
          {%- endfor -%}
    - service: switch.turn_off
      data_template:
        entity_id: >
          {%- for state in states.switch if
          state.entity_id != 'switch.rikis_food' and
          state.entity_id != 'switch.trantor_power'-%}
          {{- "," if not loop.first-}}{{ state.entity_id }}{{-endif-}}
          {%- endfor -%}
    - service: media_player.turn_off
      data_template:
        entity_id: >
          {%- for state in states.media_player if
          state.entity_id != 'media_player.TEST'-%}
          {{- "," if not loop.first-}}{{ state.entity_id }}{{-endif-}}
          {%- endfor -%}
nothing:
  alias: nothing
  sequence:

door_lock:
  alias: Door Lock
  sequence:
    - service: shell_command.lock
    - service: notify.hass
      data:
        message:  "door locked"

door_unlock:
  alias: Door Unlock
  sequence:
    - service: shell_command.unlock
    - service: notify.hass
      data:
        message:  "door unlocked"
